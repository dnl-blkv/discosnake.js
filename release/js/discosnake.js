/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

// MIT license

/**
 * Basic parser for URL properties
 * @author Miller Medeiros
 * @version 0.1.0 (2011/12/06)
 * MIT license
 */

/** @license
 * RequireJS plugin for loading web fonts using the WebFont Loader
 * Author: Miller Medeiros
 * Version: 0.2.0 (2011/12/06)
 * Released under the MIT license
 */

define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),define("game/Tile",["./Tile"],function(e){function e(e,t,n,r,i){this.fontSize=e,this.cellX=t,this.cellY=n,this.fillStyle=r,this.lineStyle=i}return e.prototype.draw=function(e){var t=this.getX(),n=this.getY(),r=this.getSize(),i=this.getFillStyle(),s=this.getLineStyle();e.drawRect(t,n,r,r,i,s)},e.prototype.getSize=function(){return this.fontSize},e.prototype.getX=function(){return this.cellX*this.fontSize},e.prototype.getY=function(){return this.cellY*this.fontSize},e.prototype.getCellX=function(){return this.cellX},e.prototype.setCellX=function(e,t){var n=e.getCellsWidth();this.cellX=(t+n)%n},e.prototype.getCellY=function(){return this.cellY},e.prototype.setCellY=function(e,t){var n=e.getCellsHeight();this.cellY=(t+n)%n},e.prototype.setFillStyle=function(e){this.fillStyle=e},e.prototype.getFillStyle=function(){return this.fillStyle},e.prototype.setLineStyle=function(e){this.lineStyle=e},e.prototype.getLineStyle=function(){return this.lineStyle},e.prototype.doesCollideWith=function(e){var t=this.cellX===e.cellX,n=this.cellY===e.cellY;return t&&n},e}),define("utils/numberUtils",[],function(){function e(e,t){var n=t-e,r=Math.floor(Math.random()*n),i=Math.floor(e),s=i+r;return s}function t(e,t){var n=t-e,r=Math.random()*n,i=e,s=i+r;return s}return{getRandomInteger:e,getRandomNumber:t}}),define("game/Apple",["./Tile","utils/numberUtils"],function(e,t){function r(t,n,r){var i="#20ff00",s="#1de600";e.call(this,t,n,r,i,s)}var n=t.getRandomInteger;return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.placeRandomly=function(e){var t=e.getCellsWidth(),r=e.getCellsHeight();this.setCellX(e,n(0,t)),this.setCellY(e,n(0,r))},r}),define("game/CommandCode",[],function(){return{NULL_COMMAND:"nullCommand",RESET_GAME:"resetGame",TURN_SNAKE_LEFT:"turnSnakeLeft",TURN_SNAKE_UP:"turnSnakeUp",TURN_SNAKE_RIGHT:"turnSnakeRight",TURN_SNAKE_DOWN:"turnSnakeDown",TOGGLE_PAUSE:"togglePause"}}),define("game/Direction",[],function(){return{LEFT:0,UP:1,RIGHT:2,DOWN:3}}),define("input/KeyCode",[],function(){return{NULL_KEY:0,LEFT:37,UP:38,RIGHT:39,DOWN:40,R:82,SPACE:32}}),define("input/Controls",["./KeyCode"],function(e){function t(){this.keyDownCommandMap={},this.keyUpCommandMap={}}return t.prototype.bindKeyDown=function(e,t){this.keyDownCommandMap[e]=t},t.prototype.getKeyDownBinding=function(e){return this.keyDownCommandMap[e]},t.prototype.unbindKeyDown=function(t){this.keyDownCommandMap[t]=e.NULL_KEY},t.prototype.bindKeyUp=function(e,t){this.keyUpCommandMap[e]=t},t.prototype.getKeyUpBinding=function(e){return this.keyUpCommandMap[e]},t.prototype.unbindKeyUp=function(t){this.keyUpCommandMap[t]=e.NULL_KEY},t}),define("game/defaultControls",["game/CommandCode","input/Controls","input/KeyCode"],function(e,t,n){function r(){var r=new t;return r.bindKeyDown(n.LEFT,e.TURN_SNAKE_LEFT),r.bindKeyDown(n.UP,e.TURN_SNAKE_UP),r.bindKeyDown(n.RIGHT,e.TURN_SNAKE_RIGHT),r.bindKeyDown(n.DOWN,e.TURN_SNAKE_DOWN),r.bindKeyDown(n.SPACE,e.TOGGLE_PAUSE),r.bindKeyDown(n.R,e.RESET_GAME),r}return r()}),define("input/InputEvent",[],function(){return{CLICK:"click",KEY_DOWN:"keydown",KEY_UP:"keyup",RESIZE:"resize",TOUCH_START:"touchstart"}}),define("utils/htmlUtils",[],function(){function e(e){var t=document.documentElement.clientWidth,n=document.documentElement.clientHeight;e.style.position="absolute",e.style.left=(t-e.offsetWidth)/2+"px",e.style.top=(n-e.offsetHeight)/2+window.pageYOffset+"px"}return{centreElement:e}}),define("graphics/Graphics",["input/InputEvent","utils/htmlUtils"],function(e,t){function r(t,n){this.canvas=document.createElement("canvas"),this.width,this.setWidth(t),this.height,this.setHeight(n),this.canvas.class="gameGraphics",this.canvas.style.backgroundColor="#000000",this.canvas.style.zIndex=8;var r=this.getContext();r.translate(.5,.5),r.lineWidth=.75;var s=document.getElementsByTagName("body")[0];s.appendChild(this.canvas);var o=this;window.addEventListener(e.RESIZE,function(){i(o)}),i(o)}function i(e){n(e.canvas)}var n=t.centreElement;return r.prototype.reset=function(){var e=this.getContext();e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.restore()},r.prototype.setWidth=function(e){this.width=e,this.canvas.width=e,this.canvas.style.width=e+"px"},r.prototype.getWidth=function(){return this.width},r.prototype.setHeight=function(e){this.height=e,this.canvas.height=e,this.canvas.style.height=e+"px"},r.prototype.getHeight=function(){return this.canvas.height},r.prototype.getContext=function(){var e=this.canvas.getContext("2d");return e},r.prototype.drawRect=function(e,t,n,r,i,s){var o=this.getContext();o.beginPath(),o.rect(e,t,n,r),o.fillStyle=i,o.fill(),o.strokeStyle=s,o.stroke()},r.prototype.buildFontString=function(e,t){var n=""+e+"px "+t;return n},r.prototype.drawText=function(e,t,n,r,i,s,o){var u=this.getContext();u.beginPath(),u.font=this.buildFontString(r,i),u.textAlign="left",u.fillStyle=s,u.fillText(n,e,t,o)},r}),define("utils/timeUtils",[],function(){function e(){var e=window.performance.now?performance.now()+performance.timing.navigationStart:Date.now();return e}return Date.now||(Date.now=function(){(new Date).getTime()}),function(){var t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){var r=t[n];window.requestAnimationFrame=window[r+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var i=0;window.requestAnimationFrame=function(t){var n=e(),r=Math.max(i+16,n);return setTimeout(function(){t(i=r)},r-n)},window.cancelAnimationFrame=clearTimeout}}(),{timeNow:e,requestAnimationFrame:window.requestAnimationFrame,cancelAnimationFrame:window.cancelAnimationFrame}}),define("input/Manipulator",["./InputEvent","./Controls","./KeyCode","utils/timeUtils"],function(e,t,n,r){function s(){this.nullCommandCode="nullCommand",this.commandListener=null,this.commandListenerArguments=null,this.controls=new t,this.keysPressed={};var n=this;window.addEventListener(e.KEY_DOWN,function(e){n.onKeyDown(e)},!1),window.addEventListener(e.KEY_UP,function(e){n.onKeyUp(e)},!1)}function o(t,n){var r=n.keyCode,i=n.type,s=t.nullCommandCode,o=t.controls;switch(i){case e.KEY_DOWN:s=o.getKeyDownBinding(r);break;case e.KEY_UP:s=o.getKeyUpBinding(r);break;default:}return s}function u(e,t){var n=e.commandListener,r=o(e,t);if(r!==this.nullCommandCode){var i=Array.prototype.slice.call(e.commandListenerArguments);i.push(r),n.apply(n,i)}}var i=r.timeNow;return s.prototype.setControls=function(e){this.controls=e},s.prototype.getControls=function(){return this.controls},s.prototype.isKeyDown=function(e){return this.keysPressed[e]},s.prototype.setCommandListener=function(){var e=Array.prototype.slice.call(arguments);this.commandListener=e[0],this.commandListenerArguments=e.slice(1,e.length)},s.prototype.onKeyDown=function(e){this.keysPressed[e.keyCode]=i(),u(this,e)},s.prototype.onKeyUp=function(e){this.keysPressed[e.keyCode]=0,u(this,e)},s.prototype.bindKeyDown=function(e,t){this.controls.bindKeyDown(e,t)},s.prototype.unbindKeyDown=function(e){this.controls.unbindKeyDown(e)},s.prototype.bindKeyUp=function(e,t){this.controls.bindKeyUp(e,t)},s.prototype.unbindKeyUp=function(e){this.controls.unbindKeyUp(e)},s.prototype.setNullCommandCode=function(e){this.nullCommandCode=e},s}),define("game/TextObject",[],function(){function e(e,t,n,r,i,s,o){this.x=e,this.y=t,this.text=n,this.fontSize=r||12,this.fontFamily=i||"Arial",this.fontColor=s||"black",this.maxWidth=o||5*r,this.width=0}return e.prototype.setText=function(e){this.text=e},e.prototype.getText=function(){return this.text},e.prototype.setFontSize=function(e){this.fontSize=e},e.prototype.getFontSize=function(){return this.fontSize},e.prototype.setFontName=function(e){this.fontFamily=e},e.prototype.getFontName=function(){return this.fontFamily},e.prototype.setFontColor=function(e){this.fontColor=e},e.prototype.getFontColor=function(){return this.fontColor},e.prototype.setMaxWidth=function(e){this.maxWidth=e},e.prototype.getMaxWidth=function(){return this.maxWidth},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.fontSize},e.prototype.draw=function(e){e.drawText(this.x,this.y,this.text,this.fontSize,this.fontFamily,this.fontColor,this.maxWidth)},e}),define("graphics/Color",["utils/numberUtils"],function(e){function n(e,t,n){this.red=e,this.green=t,this.blue=n}var t=e.getRandomNumber;return n.prototype.getHexString=function(){var e="#";return e+=this.getHexRed(),e+=this.getHexBlue(),e+=this.getHexGreen(),e},n.prototype.getRed=function(){return this.red},n.prototype.getHexRed=function(){var e=this.getRed();return n.toHexChannel(e)},n.prototype.setRed=function(e){this.red=e},n.prototype.getGreen=function(){return this.green},n.prototype.getHexGreen=function(){var e=this.getGreen();return n.toHexChannel(e)},n.prototype.setGreen=function(e){this.green=e},n.prototype.getBlue=function(){return this.blue},n.prototype.getHexBlue=function(){var e=this.getBlue();return n.toHexChannel(e)},n.prototype.setBlue=function(e){this.blue=e},n.prototype.copy=function(){return new n(this.getRed(),this.getGreen(),this.getBlue())},n.prototype.blend=function(e,t){var n=this.copy();return t===undefined&&(t=.5),n.setRed(Math.floor(n.getRed()*t+e.getRed()*(1-t))),n.setGreen(Math.floor(n.getGreen()*t+e.getGreen()*(1-t))),n.setBlue(Math.floor(n.getBlue()*t+e.getBlue()*(1-t))),console.log(t,n),n},n.fromHSV=function(e,t,r){var i=[0,0,0],s=Math.floor(e*6),o=e*6-s,u=r*(1-t),a=r*(1-o*t),f=r*(1-(1-o)*t);switch(s){case 0:i=[r,f,u];break;case 1:i=[a,r,u];break;case 2:i=[u,r,f];break;case 3:i=[u,a,r];break;case 4:i=[f,u,r];break;case 5:i=[r,u,a];break;default:}var l=Math.round(256*i[0]),c=Math.round(256*i[1]),h=Math.round(256*i[2]),p=new n(l,c,h);return p},n.fromHexString=function(e){var t=e.substring(1),r=t.match(/.{2}/g),i=parseInt(r[0],16),s=parseInt(r[1],16),o=parseInt(r[2],16);return new n(i,s,o)},n.getRandomColor=function(e){var r=e.h,i=t(r.from,r.to),s=e.s,o=t(s.from,s.to),u=e.v,a=t(u.from,u.to),f=n.fromHSV(i,o,a);return f},n.toHexChannel=function(e){return("0"+e.toString(16)).substr(-2)},n.getRandomPsychedelicColor=function(){var e={h:{from:0,to:.99},s:{from:.9,to:.99},v:{from:.99,to:.99}},t=n.getRandomColor(e);return t},n}),define("utils/graphicUtils",["graphics/Color"],function(e){function t(){var t=e.getRandomColor();return t.getHexString()}function n(){var t=e.getRandomPsychedelicColor();return t}function r(){return{width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight}}return{getRandomCssColor:t,getRandomPsychedelicColor:n,getWindowsSize:r}}),define("game/ScoreBoard",["./TextObject","utils/graphicUtils"],function(e,t){function r(){this.score=0;var t=72,n=20,r=t/2+20,i=""+this.score,s="#999999",o="Wendy";this.scoreScreen=new e(n,r,i,t,o,s)}function i(e){var t=e.scoreScreen;t.text=""+e.score}var n=t.getRandomPsychedelicCssColor;return r.prototype.incrementScore=function(){this.score++,i(this)},r.prototype.decrementScore=function(){this.score--,i(this)},r.prototype.draw=function(e){this.scoreScreen.draw(e)},r}),define("game/SnakePart",["./Tile","utils/graphicUtils"],function(e,t){function r(t,r,i){this.color=n(),this.previousPart=null,this.nextPart=null;var s=this.color.getHexString(),o="#ffffff";e.call(this,t,r,i,s,o)}var n=t.getRandomPsychedelicColor;return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.setPreviousPart=function(e){this.previousPart=e},r.prototype.getPreviousPart=function(){return this.previousPart},r.prototype.setNextPart=function(e){this.nextPart=e},r.prototype.getNextPart=function(){return this.nextPart},r.prototype.moveRight=function(e){this.setCellX(e,this.cellX+1)},r.prototype.moveLeft=function(e){this.setCellX(e,this.cellX-1)},r.prototype.moveDown=function(e){this.setCellY(e,this.cellY+1)},r.prototype.moveUp=function(e){this.setCellY(e,this.cellY-1)},r.prototype.dragTo=function(e,t){this.setCellX(e,t.getCellX()),this.setCellY(e,t.getCellY())},r.prototype.draw=function(t){var r=n();this.setFillStyle(r.getHexString()),e.prototype.draw.call(this,t)},r}),define("game/Snake",["./SnakePart"],function(e){function t(t,n,r,i){this.cellSize=t,this.length=1,this.head=new e(t,n,r),this.addParts(i-1)}function n(e,t){var n=e.getTail(),r=n.getPreviousPart();while(r!==null)n.dragTo(t,r),n=r,r=r.getPreviousPart()}return t.prototype.isAppleEaten=function(e){var t=this.getHead(),n=t.doesCollideWith(e);return n},t.prototype.moveRight=function(e){n(this,e),this.head.moveRight(e)},t.prototype.moveLeft=function(e){n(this,e),this.head.moveLeft(e)},t.prototype.moveDown=function(e){n(this,e),this.head.moveDown(e)},t.prototype.moveUp=function(e){n(this,e),this.head.moveUp(e)},t.prototype.draw=function(e){var t=this.getHead();do t.draw(e),t=t.getNextPart();while(t!==null)},t.prototype.getHead=function(){return this.head},t.prototype.getTail=function(){var e=this.getHead(),t=e.getNextPart();while(t!==null)e=t,t=e.getNextPart();return e},t.prototype.getLength=function(){return this.length},t.prototype.addPart=function(){var t=this.getTail(),n=new e(this.cellSize,t.getCellX(),t.getCellY());t.setNextPart(n),n.setPreviousPart(t),this.length++},t.prototype.addParts=function(e){for(var t=0;t<e;t++)this.addPart()},t}),define("propertyParser",[],function(){function n(t){var n,i={};while(n=e.exec(t))i[n[1]]=r(n[2]||n[3]);return i}function r(e){return t.test(e)?e=e.replace(t,"$1").split(","):e==="null"?e=null:e==="false"?e=!1:e==="true"?e=!0:e===""||e==="''"||e==='""'?e="":isNaN(e)||(e=+e),e}var e=/([\w-]+)\s*:\s*(?:(\[[^\]]+\])|([^,]+)),?/g,t=/^\[([^\]]+)\]$/;return{parseProperties:n,typecastVal:r}}),define("font",["propertyParser"],function(e){function n(n){var r={},i=n.split("|"),s=i.length,o;while(s--)o=t.exec(i[s]),r[o[1]]=e.parseProperties(o[2]);return r}var t=/^([^,]+),([^\|]+)\|?/;return{load:function(e,t,r,i){if(i.isBuild)r(null);else{var s=n(e);s.active=r,s.inactive=function(){r(!1)},t([(document.location.protocol==="https:"?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js"],function(){WebFont.load(s)})}}}}),define("game/Game",["./Apple","./CommandCode","./Direction","./defaultControls","graphics/Graphics","input/InputEvent","input/KeyCode","input/Manipulator","./ScoreBoard","./Snake","./TextObject","utils/timeUtils","font!custom,families:[Wendy],urls:[style/style.css]"],function(e,t,n,r,i,s,o,u,a,f,l,c){function v(e,t,n){this.then=d(),this.cellSize=e,this.cellsWidth=t,this.cellsHeight=n,this.fps=20,this.defaultSnakeLength=4,this.lastRequestId=0,this.stopped=!1,this.lastRequestId=0,this.scoreBoard=new a,this.apple=null;var r=t*e+1,o=n*e+1;this.graphics=new i(r,o),this.manipulator=new u,this.manipulator.setCommandListener(y,this),m(this);var f=this;this.graphics.canvas.addEventListener(s.TOUCH_START,function(e){S(f,e)}),g(this)}function m(e){e.manipulator.setControls(r)}function g(e){e.then=d(),e.currentDirection=n.RIGHT;var t=Math.round(e.cellsWidth/2),r=Math.round(e.cellsHeight/2);e.snake=new f(e.cellSize,t,r,e.defaultSnakeLength),x(e),N(e)}function y(e,r){switch(r){case t.TOGGLE_PAUSE:k(e);break;case t.RESET_GAME:g(e);break;default:}if(!e.isStopped())switch(r){case t.TURN_SNAKE_LEFT:e.currentDirection=n.LEFT;break;case t.TURN_SNAKE_UP:e.currentDirection=n.UP;break;case t.TURN_SNAKE_RIGHT:e.currentDirection=n.RIGHT;break;case t.TURN_SNAKE_DOWN:e.currentDirection=n.DOWN;break;default:}}function b(e,t){var n=t.touches[0].clientX,r=t.touches[0].clientY;return E(e,n,r)}function w(e,t){var n=t.pageX,r=t.pageY;return E(e,n,r)}function E(e,t,n){var r=0,i=0,s=0,o=0,u=e;do r+=u.offsetLeft-u.scrollLeft,i+=u.offsetTop-u.scrollTop;while(u=u.offsetParent);return s=t-r,o=n-i,{x:s,y:o}}function S(e,t){var r=b(e.graphics.canvas,t),i=e.graphics.width,s=e.graphics.height,o=i/2,u=s/2,a=i/s,f=r.x-o,l=(-r.y+u)*a;t.touches.length>1?k(e):-f<=l&&f<=l?e.currentDirection=n.UP:-f<l&&f>l?e.currentDirection=n.RIGHT:-f>=l&&f>=l?e.currentDirection=n.DOWN:e.currentDirection=n.LEFT}function x(t){t.apple=new e(t.cellSize,-1,-1),t.apple.placeRandomly(t)}function T(e){C(e)}function N(e){e.graphics.reset(),e.scoreBoard.draw(e.graphics),e.apple.draw(e.graphics),e.snake.draw(e.graphics)}function C(e){var t=e.snake;switch(e.currentDirection){case n.LEFT:t.moveLeft(e);break;case n.UP:t.moveUp(e);break;case n.RIGHT:t.moveRight(e);break;case n.DOWN:t.moveDown(e);break;default:}var r=e.apple,i=t.isAppleEaten(r);i&&(t.addPart(),x(e),e.scoreBoard.incrementScore())}function k(e){e.isStopped()?e.start():e.pause()}var h=c.requestAnimationFrame,p=c.cancelAnimationFrame,d=c.timeNow;return v.prototype.pause=function(){var e=this.lastRequestId;e&&p(e),this.lastRequestId=0,this.stopped=!0},v.prototype.isStopped=function(){return this.stopped},v.prototype.start=function(){this.stopped=!1,this.then=d(),this.run()},v.prototype.run=function(){var e=this.run.bind(this),t=this,n=function(){t.then=d(),t.lastRequestId=h(e),T(t),N(t)},r=0,i=1e3/this.fps,s=this.isStopped();s||(r=d()-this.then,i-=r,setTimeout(n,i))},v.prototype.getCellsWidth=function(){return this.cellsWidth},v.prototype.getCellsHeight=function(){return this.cellsHeight},v}),define("app/main",["domReady","game/Game"],function(e,t){function n(){var e=20,n=48,r=30,i=new t(e,n,r);i.start()}e(n)}),requirejs.config({baseUrl:"js/lib",paths:{app:"../app"},packages:[{name:"game",location:"../app/game"},{name:"graphics",location:"../app/graphics"},{name:"input",location:"../app/input"},{name:"style",location:"../app/style"},{name:"utils",location:"../app/utils"}]}),requirejs(["app/main"]),define("app",function(){});