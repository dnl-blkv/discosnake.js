/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

// MIT license

/**
 * Basic parser for URL properties
 * @author Miller Medeiros
 * @version 0.1.0 (2011/12/06)
 * MIT license
 */

/** @license
 * RequireJS plugin for loading web fonts using the WebFont Loader
 * Author: Miller Medeiros
 * Version: 0.2.0 (2011/12/06)
 * Released under the MIT license
 */

define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c}),define("game/AppleSubstance",[],function(){return{NO_SUBSTANCE:"noSubstance",ALCOHOL:"alcohol"}}),define("engine/utils/numberUtils",[],function(){function e(e,t){var n=t-e,r=Math.floor(Math.random()*n),i=Math.floor(e),s=i+r;return s}function t(e,t){var n=t-e,r=Math.random()*n,i=e,s=i+r;return s}function n(e,t){var n=e;return e>0?n=Math.ceil(e/t)*t:e<0&&(n=Math.floor(e/t)*t),n}function r(e,t){var n=e;return e>0?n=Math.floor(e/t)*t:e<0&&(n=Math.ceil(e/t)*t),n}return{getRandomInteger:e,getRandomNumber:t,roundDownToMultiple:n,roundUpToMultiple:r}}),define("engine/graphics/Color",["engine/utils/numberUtils"],function(e){function n(e,t,n){this.red=e,this.green=t,this.blue=n}var t=e.getRandomNumber;return n.prototype.getHexString=function(){var e="#";return e+=this.getHexRed(),e+=this.getHexBlue(),e+=this.getHexGreen(),e},n.prototype.setRed=function(e){this.red=e},n.prototype.getRed=function(){return this.red},n.prototype.getHexRed=function(){var e=this.getRed();return n.toHexChannel(e)},n.prototype.setGreen=function(e){this.green=e},n.prototype.getGreen=function(){return this.green},n.prototype.getHexGreen=function(){var e=this.getGreen();return n.toHexChannel(e)},n.prototype.setBlue=function(e){this.blue=e},n.prototype.getBlue=function(){return this.blue},n.prototype.getHexBlue=function(){var e=this.getBlue();return n.toHexChannel(e)},n.prototype.copy=function(){return new n(this.getRed(),this.getGreen(),this.getBlue())},n.prototype.blend=function(e,t){var n=this.copy();return t===undefined&&(t=.5),n.setRed(Math.floor(n.getRed()*t+e.getRed()*(1-t))),n.setGreen(Math.floor(n.getGreen()*t+e.getGreen()*(1-t))),n.setBlue(Math.floor(n.getBlue()*t+e.getBlue()*(1-t))),console.log(t,n),n},n.fromHSV=function(e,t,r){var i=[0,0,0],s=Math.floor(e*6),o=e*6-s,u=r*(1-t),a=r*(1-o*t),f=r*(1-(1-o)*t);switch(s){case 0:i=[r,f,u];break;case 1:i=[a,r,u];break;case 2:i=[u,r,f];break;case 3:i=[u,a,r];break;case 4:i=[f,u,r];break;case 5:i=[r,u,a];break;default:}var l=Math.round(256*i[0]),c=Math.round(256*i[1]),h=Math.round(256*i[2]),p=new n(l,c,h);return p},n.fromHexString=function(e){var t=e.substring(1),r=t.match(/.{2}/g),i=parseInt(r[0],16),s=parseInt(r[1],16),o=parseInt(r[2],16);return new n(i,s,o)},n.getRandomColor=function(e){var r=e.h,i=t(r.from,r.to),s=e.s,o=t(s.from,s.to),u=e.v,a=t(u.from,u.to),f=n.fromHSV(i,o,a);return f},n.toHexChannel=function(e){return("0"+e.toString(16)).substr(-2)},n.getRandomPsychedelicColor=function(){var e={h:{from:0,to:.99},s:{from:.85,to:.99},v:{from:.99,to:.99}},t=n.getRandomColor(e);return t},n}),define("engine/graphics/DisplayObject",[],function(){function e(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r}return e.prototype.setX=function(e){this.x=e},e.prototype.getX=function(){return this.x},e.prototype.setY=function(e){this.y=e},e.prototype.getY=function(){return this.y},e.prototype.setWidth=function(e){this.width=e},e.prototype.getWidth=function(){return this.width},e.prototype.setHeight=function(e){this.height=e},e.prototype.getHeight=function(){return this.height},e}),define("engine/input/InputEvent",[],function(){return{CLICK:"click",KEY_DOWN:"keydown",KEY_UP:"keyup",RESIZE:"resize",TOUCH_START:"touchstart",TOUCH_END:"touchend"}}),define("engine/utils/htmlUtils",[],function(){function e(e){var t=document.documentElement.clientWidth,n=document.documentElement.clientHeight;e.style.position="absolute",e.style.left=(t-e.offsetWidth)/2+"px",e.style.top=(n-e.offsetHeight)/2+window.pageYOffset+"px"}function t(e,t){var n=""+e+"px "+t;return n}function n(e,t,n){var r=0,i=0,s=e;do r+=s.offsetLeft-s.scrollLeft,i+=s.offsetTop-s.scrollTop;while(s=s.offsetParent);var o=t-r,u=n-i;return{x:o,y:u}}function r(e,t){var r=t.pageX,i=t.pageY;return n(e,r,i)}function i(e,t){var n=t.touches.length-1;return s(e,t.touches[n])}function s(e,t){var r=t.clientX,i=t.clientY;return n(e,r,i)}function o(){return{width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight}}function u(){return document.getElementsByTagName("body")[0]}return{centreElement:e,buildFontString:t,relCoords:n,relLastTouchCoords:i,relMouseCoords:r,relTouchCoords:s,getWindowsSize:o,getBody:u}}),define("engine/graphics/Graphics",["engine/input/InputEvent","engine/utils/htmlUtils"],function(e,t){function i(t,r,i){var s=document.createElement("canvas");s.width=t,s.style.width=t+"px",s.height=r,s.style.height=r+"px",s.class="graphics",s.style.backgroundColor=i,s.style.zIndex=-1;var o=s.getContext("2d");o.translate(.5,.5),o.lineWidth=.75;var u=document.getElementsByTagName("body")[0];u.appendChild(s),window.addEventListener(e.RESIZE,function(){n(s)}),n(s),this.canvas=s}var n=t.centreElement,r=t.buildFontString;return i.prototype.reset=function(){var e=this.getContext();e.save(),e.setTransform(1,0,0,1,0,0);var t=this.getWidth(),n=this.getHeight();e.clearRect(0,0,t,n),e.restore()},i.prototype.getWidth=function(){return this.canvas.width},i.prototype.getHeight=function(){return this.canvas.height},i.prototype.getContext=function(){var e=this.canvas.getContext("2d");return e},i.prototype.drawRect=function(e,t,n,r,i,s){var o=this.getContext();o.beginPath(),o.rect(e,t,n,r),o.fillStyle=i,o.fill(),o.strokeStyle=s,o.stroke()},i.prototype.drawText=function(e,t,n,i,s,o,u){var a=this.getContext();a.beginPath(),a.font=r(i,s),a.textBaseline="middle",a.textAlign="left",a.fillStyle=o,a.fillText(n,e,t,u)},i.prototype.getTextWidth=function(e,t,n){var i=this.getContext(),s=r(t,n);i.font=s;var o=i.measureText(e),u=o.width;return u},i}),define("engine/graphics/TextObject",["engine/graphics/DisplayObject"],function(e){function t(t,n,r,i,s){e.call(this,0,0,0,0),this.text=t,this.setFontSize(n||12),this.fontFamily=r||"Arial",this.fontColor=i||"black",this.maxWidth=s||5*n,this.html=document.createElement("div"),this.updateHTML()}function n(e){e.html.innerHTML=e.text}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.setText=function(e){this.text=e,n(this)},t.prototype.getText=function(){return this.text},t.prototype.setFontSize=function(e){this.fontSize=e,this.setHeight(e)},t.prototype.getFontSize=function(){return this.fontSize},t.prototype.setFontName=function(e){this.fontFamily=e},t.prototype.getFontName=function(){return this.fontFamily},t.prototype.setFontColor=function(e){this.fontColor=e},t.prototype.getFontColor=function(){return this.fontColor},t.prototype.setMaxWidth=function(e){this.maxWidth=e},t.prototype.getMaxWidth=function(){return this.maxWidth},t.prototype.getWidth=function(e){var t=e.getTextWidth(this.text,this.fontSize,this.fontFamily);return t},t.prototype.draw=function(e){var t=this.getWidth(e);this.setWidth(t);var n=this.getX(),r=this.getY()+this.fontSize/2;e.drawText(n,r,this.text,this.fontSize,this.fontFamily,this.fontColor,this.maxWidth)},t.prototype.getHTML=function(){return this.html},t.prototype.updateHTMLStyle=function(){var e=this.html;return e.className="text-object unselectable default-cursor",e.style.fontSize=this.fontSize+"px",e.style.color=this.fontColor,e.style.fontFamily=this.fontFamily,e},t.prototype.updateHTML=function(){n(this),this.updateHTMLStyle()},t}),define("engine/graphics/Tile",["engine/graphics/DisplayObject"],function(e){function t(t,n,r,i,s){e.call(this,0,0,0,0),this.setSize(t),this.setCellX(n),this.setCellY(r),this.fillStyle=i,this.lineStyle=s}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.draw=function(e){var t=this.getX(),n=this.getY(),r=this.getSize(),i=this.getFillStyle(),s=this.getLineStyle();e.drawRect(t,n,r,r,i,s)},t.prototype.setSize=function(e){this.size=e,this.setWidth(e),this.setHeight(e)},t.prototype.getSize=function(){return this.size},t.prototype.setCellX=function(e,t){t!==undefined?this.cellX=(e+t)%t:this.cellX=e,this.setX(this.cellX*this.size)},t.prototype.getCellX=function(){return this.cellX},t.prototype.setCellY=function(e,t){t!==undefined?this.cellY=(e+t)%t:this.cellY=e,this.setY(this.cellY*this.size)},t.prototype.getCellY=function(){return this.cellY},t.prototype.setFillStyle=function(e){this.fillStyle=e},t.prototype.getFillStyle=function(){return this.fillStyle},t.prototype.setLineStyle=function(e){this.lineStyle=e},t.prototype.getLineStyle=function(){return this.lineStyle},t.prototype.doesCollideWith=function(e){var t=this.cellX===e.cellX,n=this.cellY===e.cellY;return t&&n},t}),define("engine/graphics/main",["./Color","./DisplayObject","./Graphics","./TextObject","./Tile"],function(e,t,n,r,i){return{Color:e,DisplayObject:t,Graphics:n,TextObject:r,Tile:i}}),define("engine/input/KeyCode",[],function(){return{NULL_KEY:0,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,R:82,S:83,W:87}}),define("engine/input/Controls",["./KeyCode"],function(e){function t(){this.keyDownCommandMap={},this.keyUpCommandMap={}}return t.prototype.bindKeyDown=function(e,t){this.keyDownCommandMap[e]=t},t.prototype.getKeyDownBinding=function(e){return this.keyDownCommandMap[e]},t.prototype.unbindKeyDown=function(t){this.keyDownCommandMap[t]=e.NULL_KEY},t.prototype.bindKeyUp=function(e,t){this.keyUpCommandMap[e]=t},t.prototype.getKeyUpBinding=function(e){return this.keyUpCommandMap[e]},t.prototype.unbindKeyUp=function(t){this.keyUpCommandMap[t]=e.NULL_KEY},t}),define("engine/utils/timeUtils",[],function(){function e(){var e=window.performance.now?performance.now()+performance.timing.navigationStart:Date.now();return e}return Date.now||(Date.now=function(){(new Date).getTime()}),function(){var t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){var r=t[n];window.requestAnimationFrame=window[r+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r+"CancelAnimationFrame"]||window[r+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var i=0;window.requestAnimationFrame=function(t){var n=e(),r=Math.max(i+16,n);return setTimeout(function(){t(i=r)},r-n)},window.cancelAnimationFrame=clearTimeout}}(),{timeNow:e,requestAnimationFrame:window.requestAnimationFrame,cancelAnimationFrame:window.cancelAnimationFrame}}),define("engine/input/Manipulator",["./InputEvent","./Controls","./KeyCode","engine/utils/timeUtils"],function(e,t,n,r){function s(){this.nullCommandCode="nullCommand",this.commandListener=null,this.commandListenerArguments=null,this.controls=new t,this.keysPressed={};var n=this;window.addEventListener(e.KEY_DOWN,function(e){n.onKeyDown(e)},!1),window.addEventListener(e.KEY_UP,function(e){n.onKeyUp(e)},!1)}function o(t,n){var r=n.keyCode,i=n.type,s=t.nullCommandCode,o=t.controls;switch(i){case e.KEY_DOWN:s=o.getKeyDownBinding(r);break;case e.KEY_UP:s=o.getKeyUpBinding(r);break;default:}return!s&&s!==0&&(s=t.nullCommandCode),s}function u(e,t){var n=e.commandListener,r=o(e,t);if(r!==e.nullCommandCode){var i=Array.prototype.slice.call(e.commandListenerArguments);i.push(r),n.apply(n,i)}}var i=r.timeNow;return s.prototype.setControls=function(e){this.controls=e},s.prototype.getControls=function(){return this.controls},s.prototype.isKeyDown=function(e){return this.keysPressed[e]},s.prototype.setCommandListener=function(){var e=Array.prototype.slice.call(arguments);this.commandListener=e[0],this.commandListenerArguments=e.slice(1,e.length)},s.prototype.onKeyDown=function(e){this.keysPressed[e.keyCode]=i(),u(this,e)},s.prototype.onKeyUp=function(e){this.keysPressed[e.keyCode]=0,u(this,e)},s.prototype.bindKeyDown=function(e,t){this.controls.bindKeyDown(e,t)},s.prototype.unbindKeyDown=function(e){this.controls.unbindKeyDown(e)},s.prototype.bindKeyUp=function(e,t){this.controls.bindKeyUp(e,t)},s.prototype.unbindKeyUp=function(e){this.controls.unbindKeyUp(e)},s.prototype.setNullCommandCode=function(e){this.nullCommandCode=e},s}),define("engine/input/main",["./Controls","./InputEvent","./KeyCode","./Manipulator"],function(e,t,n,r){return{Controls:e,InputEvent:t,KeyCode:n,Manipulator:r}}),define("engine/utils/graphicUtils",["engine/graphics/Color"],function(e){function t(){var t=e.getRandomColor();return t.getHexString()}function n(){var t=e.getRandomPsychedelicColor();return t}return{getRandomCssColor:t,getRandomPsychedelicColor:n}}),define("engine/utils/main",["./graphicUtils","./htmlUtils","./numberUtils","./timeUtils"],function(e,t,n,r){return{graphicUtils:e,htmlUtils:t,numberUtils:n,timeUtils:r}}),define("engine/ui/Menu",["engine/graphics/DisplayObject","engine/utils/numberUtils"],function(e,t){function i(){e.call(this,0,0,0,0),this.items=[],this.focusedItemId=0,this.itemSelectedListener=null,this.itemSelectedListenerArguments=null,this.backgroundColor="#000000",this.backgroundBorderColor="#FFFFFF",this.html=document.createElement("div");var t=this;this.html.addEventListener("DOMNodeInserted",function(e){s(t)},!1),this.updateHTMLStyle(),this.hide()}function s(e){var t=!e.isHidden();e.hide();var n=0,r=e.getItemsCount();for(var i=0;i<r;i++){var s=u(e),o=s.getHTML(),a=o.offsetWidth;n<a&&(n=a),e.focusNextItem()}var f=e.getHTML();e.setWidth(n),f.style.width=n+"px";var l=0;for(var i=0;i<r;i++){var s=e.getItemAt(i),o=s.getHTML(),c=o.offsetHeight;l+=c}e.setHeight(l),f.style.height=l+"px",t&&e.reveal()}function o(e,t){var n=u(e);n&&n.unfocus();var r=e.getItemsCount();r!=0?e.focusedItemId=(t+r)%r:console.log("COULD NOT FOCUS A MENU ITEM: NO ITEMS ADDED");var i=u(e);i&&i.focus()}function u(e){var t=e.focusedItemId,n=e.getItemAt(t);return n}var n=t.roundDownToMultiple,r=t.roundUpToMultiple;return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.focusNextItem=function(){o(this,this.focusedItemId+1)},i.prototype.focusPreviousItem=function(){o(this,this.focusedItemId-1)},i.prototype.focusFirstItem=function(){o(this,0)},i.prototype.setItemSelectedListener=function(){var e=Array.prototype.slice.call(arguments);this.itemSelectedListener=e[0],this.itemSelectedListenerArguments=e.slice(1,e.length)},i.prototype.selectCurrentItem=function(){var e=this.itemSelectedListener,t=this.itemSelectedListenerArguments.slice(0),n=u(this),r=n.getActionCode();t.push(r),this.itemSelectedListener.apply(e,t)},i.prototype.addItem=function(e){var t=this.getItemsCount();t===0&&e.focus(),this.items.push(e);var n=e.getHTML();this.html.appendChild(n)},i.prototype.getItemsCount=function(){return this.items.length},i.prototype.getItemAt=function(e){return this.items[e]},i.prototype.getHTML=function(){return this.html},i.prototype.hide=function(){this.getHTML().style.visibility="hidden"},i.prototype.reveal=function(){this.getHTML().style.visibility="visible"},i.prototype.isHidden=function(){var e=this.getHTML().style.visibility==="hidden";return e},i.prototype.updateHTMLStyle=function(){var e=this.html;e.className="menu unselectable default-cursor",e.style.borderColor=this.backgroundBorderColor,e.style.borderStyle="solid",e.style.borderWidth="1px",e.style.padding="0 10px 0 17px",e.style.backgroundColor=this.backgroundColor,e.style.position="absolute",e.style.whiteSpace="nowrap",e.style.left="50%",e.style.top="50%"},i.prototype.center=function(){var e=this.html;e.style.marginTop="-"+this.getHeight()/2+"px",e.style.marginLeft="-"+this.getWidth()/2+"px"},i}),define("engine/ui/MenuItem",["engine/graphics/DisplayObject","engine/graphics/TextObject"],function(e,t){function n(n,i,s,o,u,a,f){e.call(this,0,0,0,0),this.actionCode=n||"nullActionCode",this.defaultFontSize=s,this.defaultColor=u,this.focusedColor=a,this.focused=!1,this.selectedFontSizeMultiplier=1.5,this.textObject=new t(i,s,o,u,f),this.updateHTMLStyle(),r(this)}function r(e){var t=e.textObject,n=t.getHeight();e.setHeight(n)}function i(e,t){var n=e.textObject;n.setFontColor(t)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.getActionCode=function(){return this.actionCode},n.prototype.getWidth=function(e){return this.textObject.getWidth(e)},n.prototype.draw=function(e){var t=this.getWidth(e);this.setWidth(t),this.textObject.setX(this.getX()),this.textObject.setY(this.getY()),this.textObject.draw(e)},n.prototype.focus=function(){if(!this.focused){this.focused=!0;var e=this.focusedColor;i(this,e);var t=this.textObject;t.setFontSize(this.defaultFontSize*this.selectedFontSizeMultiplier),r(this),this.textObject.updateHTMLStyle()}},n.prototype.unfocus=function(){if(this.focused){this.focused=!1;var e=this.defaultColor;i(this,e);var t=this.textObject;t.setFontSize(this.defaultFontSize),r(this),this.textObject.updateHTMLStyle()}},n.prototype.updateHTMLStyle=function(){var e=this.getHTML();e.style.display="block"},n.prototype.getHTML=function(){return this.textObject.getHTML()},n}),define("engine/ui/main",["./Menu","./MenuItem"],function(e,t){return{Menu:e,MenuItem:t}}),define("engine/main",["./graphics/main","./input/main","./utils/main","./ui/main"],function(e,t,n,r){return{graphics:e,input:t,utils:n,ui:r}}),define("engine",["engine/main"],function(e){return e}),define("game/Apple",["./AppleSubstance","engine"],function(e,t){function s(t,r,s){var o=e.NO_SUBSTANCE,u="#20ff00",a="#1de600",f=7,l=i(0,f);l===f-1&&(o=e.ALCOHOL,u="#2000ff",a="#1d00e6"),this.substance=o,n.call(this,t,r,s,u,a)}var n=t.graphics.Tile,r=t.utils.numberUtils,i=r.getRandomInteger;return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.getSubstance=function(){return this.substance},s.prototype.placeRandomly=function(e){var t=e.getCellsWidth(),n=e.getCellsHeight();this.setCellX(i(0,t),e.getCellsWidth()),this.setCellY(i(0,n),e.getCellsHeight())},s}),define("game/CommandCode",[],function(){return{NULL_COMMAND:"nullCommand",TURN_SNAKE_DOWN:"turnSnakeDown",TURN_SNAKE_LEFT:"turnSnakeLeft",TURN_SNAKE_RIGHT:"turnSnakeRight",TURN_SNAKE_UP:"turnSnakeUp",TOGGLE_PAUSE:"togglePause",NEXT_MENU_ITEM:"nextMenuItem",PREVIOUS_MENU_ITEM:"previousMenuItem",SELECT_MENU_ITEM:"selectMenuItem",CONTINUE_GAME:"continueGame",NEW_GAME:"newGame"}}),define("game/controls/defaultGameControls",["game/CommandCode","engine"],function(e,t){function i(){var t=new n;return t.bindKeyDown(r.LEFT,e.TURN_SNAKE_LEFT),t.bindKeyDown(r.UP,e.TURN_SNAKE_UP),t.bindKeyDown(r.RIGHT,e.TURN_SNAKE_RIGHT),t.bindKeyDown(r.DOWN,e.TURN_SNAKE_DOWN),t.bindKeyDown(r.SPACE,e.TOGGLE_PAUSE),t}var n=t.input.Controls,r=t.input.KeyCode;return i()}),define("game/controls/invertedGameControls",["game/CommandCode","engine"],function(e,t){function i(){var t=new n;return t.bindKeyDown(r.LEFT,e.TURN_SNAKE_RIGHT),t.bindKeyDown(r.UP,e.TURN_SNAKE_DOWN),t.bindKeyDown(r.RIGHT,e.TURN_SNAKE_LEFT),t.bindKeyDown(r.DOWN,e.TURN_SNAKE_UP),t.bindKeyDown(r.SPACE,e.TOGGLE_PAUSE),t}var n=t.input.Controls,r=t.input.KeyCode;return i()}),define("game/controls/menuControls",["game/CommandCode","engine"],function(e,t){function i(){var t=new n;return t.bindKeyDown(r.DOWN,e.NEXT_MENU_ITEM),t.bindKeyDown(r.ENTER,e.SELECT_MENU_ITEM),t.bindKeyDown(r.SPACE,e.TOGGLE_PAUSE),t.bindKeyDown(r.UP,e.PREVIOUS_MENU_ITEM),t}var n=t.input.Controls,r=t.input.KeyCode;return i()}),define("game/Direction",[],function(){return{LEFT:0,UP:1,RIGHT:2,DOWN:3}}),define("game/DiscoSnakeMenuItem",["engine"],function(e){function r(e,r,i,s,o,u){var a=n.getRandomPsychedelicColor(),f=a.getHexString();t.call(this,e,r,i,s,o,f,u)}var t=e.ui.MenuItem,n=e.utils.graphicUtils;return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.focus=function(){var e=n.getRandomPsychedelicColor(),r=e.getHexString();this.focusedColor=r,t.prototype.focus.call(this)},r}),define("game/ScoreBoard",["engine"],function(e){function n(){this.score=0;var e=72,n=20,r=e/2,i=""+this.score,s="#999999",o="Wendy",u=new t(i,e,o,s);u.setX(n),u.setY(r),this.scoreScreen=u,this.updateHTMLStyle()}function r(e){var t=e.scoreScreen,n=""+e.score;t.setText(n)}var t=e.graphics.TextObject;return n.prototype.reset=function(){this.score=0,r(this)},n.prototype.getScore=function(){return this.score},n.prototype.incrementScore=function(){this.score++,r(this)},n.prototype.decrementScore=function(){this.score--,r(this)},n.prototype.draw=function(e){this.scoreScreen.draw(e)},n.prototype.getHTML=function(){return this.scoreScreen.getHTML()},n.prototype.updateHTMLStyle=function(){var e=this.getHTML();e.style.left="24px"},n}),define("game/SnakePart",["engine"],function(e){function i(e,n,i){this.color=r(),this.previousPart=null,this.nextPart=null;var s=this.color.getHexString(),o="#ffffff";t.call(this,e,n,i,s,o)}var t=e.graphics.Tile,n=e.utils.graphicUtils,r=n.getRandomPsychedelicColor;return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.setPreviousPart=function(e){this.previousPart=e},i.prototype.getPreviousPart=function(){return this.previousPart},i.prototype.setNextPart=function(e){this.nextPart=e},i.prototype.getNextPart=function(){return this.nextPart},i.prototype.moveRight=function(e){this.setCellX(this.cellX+1,e.getCellsWidth())},i.prototype.moveLeft=function(e){this.setCellX(this.cellX-1,e.getCellsWidth())},i.prototype.moveDown=function(e){this.setCellY(this.cellY+1,e.getCellsHeight())},i.prototype.moveUp=function(e){this.setCellY(this.cellY-1,e.getCellsHeight())},i.prototype.dragTo=function(e,t){this.setCellX(t.getCellX(),e.getCellsWidth()),this.setCellY(t.getCellY(),e.getCellsHeight())},i.prototype.draw=function(e){var n=r();this.setFillStyle(n.getHexString()),t.prototype.draw.call(this,e)},i}),define("game/Snake",["./AppleSubstance","./Direction","./SnakePart"],function(e,t,n){function r(e,r,i,s){this.cellSize=e,this.length=1,this.head=new n(e,r,i),this.addParts(s-1),this.direction=t.RIGHT,this.appleEatenListener=null,this.drunkness=0}function i(e,t){var n=e.getTail(),r=n.getPreviousPart();while(r!==null)n.dragTo(t,r),n=r,r=r.getPreviousPart()}function s(t,n){var r=n.getSubstance();switch(r){case e.NO_SUBSTANCE:t.drunkness>0&&t.drunkness--;break;case e.ALCOHOL:t.drunkness+=6;break;default:}}return r.prototype.getDrunkness=function(){return this.drunkness},r.prototype.isAppleEaten=function(e){var t=this.getHead(),n=t.doesCollideWith(e);return n},r.prototype.moveRight=function(e){i(this,e),this.head.moveRight(e)},r.prototype.moveLeft=function(e){i(this,e),this.head.moveLeft(e)},r.prototype.moveDown=function(e){i(this,e),this.head.moveDown(e)},r.prototype.moveUp=function(e){i(this,e),this.head.moveUp(e)},r.prototype.draw=function(e){var t=this.getHead();do t.draw(e),t=t.getNextPart();while(t!==null)},r.prototype.getHead=function(){return this.head},r.prototype.getTail=function(){var e=this.getHead(),t=e.getNextPart();while(t!==null)e=t,t=e.getNextPart();return e},r.prototype.getLength=function(){return this.length},r.prototype.setDirection=function(e){this.direction=e},r.prototype.getDirection=function(){return this.direction},r.prototype.setAppleEatenListener=function(e){this.appleEatenListener=e},r.prototype.addPart=function(){var e=this.getTail(),t=new n(this.cellSize,e.getCellX(),e.getCellY());e.setNextPart(t),t.setPreviousPart(e),this.length++},r.prototype.addParts=function(e){for(var t=0;t<e;t++)this.addPart()},r.prototype.move=function(e){var n=this.getDirection();switch(n){case t.LEFT:this.moveLeft(e);break;case t.UP:this.moveUp(e);break;case t.RIGHT:this.moveRight(e);break;case t.DOWN:this.moveDown(e);break;default:}var r=e.apple,i=this.isAppleEaten(r),o=this.appleEatenListener;i&&(this.addPart(),s(this,r),o.call(o,e))},r}),define("game/Game",["./Apple","./CommandCode","./controls/defaultGameControls","./controls/invertedGameControls","./controls/menuControls","./Direction","./DiscoSnakeMenuItem","engine","./ScoreBoard","./Snake"],function(e,t,n,r,i,s,o,u,a,f){function b(e,t,n){this.frameNumber=0,this.then=g(),this.cellSize=e,this.cellsWidth=t,this.cellsHeight=n,this.fps=20,this.defaultSnakeLength=4,this.lastRequestId=0,this.stopped=!0,this.lastRequestId=0,this.scoreBoard=new a,this.apple=null;var r=t*e+1,s=n*e+1,o="#000000";this.graphics=new l(r,s,o);var u=this.scoreBoard.getHTML(),f=y();f.appendChild(u),this.menu=null,this.pausedGameMenu=null,w(this),f.appendChild(this.menu.getHTML()),this.menu.center(),this.manipulator=new c,this.manipulator.setCommandListener(S,this),this.manipulator.setControls(i),E(this)}function w(e){var n=new h,r=48,i="Wendy",s="#FFFFFF";n.addItem(new o(t.CONTINUE_GAME,"START GAME",r,i,s,600)),n.setItemSelectedListener(S,e),e.menu=n;var u=y();u.appendChild(n.getHTML()),n.reveal(),n.center();var a=new h;a.addItem(new o(t.CONTINUE_GAME,"CONTINUE",r,i,s,600)),a.addItem(new o(t.NEW_GAME,"NEW GAME",r,i,s,600)),a.setItemSelectedListener(S,e),e.pausedGameMenu=a,u.appendChild(a.getHTML()),a.center()}function E(e){e.then=g();var t=Math.round(e.cellsWidth/2),n=Math.round(e.cellsHeight/2);e.scoreBoard.reset(),e.snake=new f(e.cellSize,t,n,e.defaultSnakeLength),e.snake.setAppleEatenListener(x),T(e),k(e)}function S(e,n){var r=e.menu,i=e.snake;switch(n){case t.TOGGLE_PAUSE:L(e);break;case t.PREVIOUS_MENU_ITEM:r.focusPreviousItem(),k(e);break;case t.NEXT_MENU_ITEM:r.focusNextItem(),k(e);break;case t.SELECT_MENU_ITEM:r.selectCurrentItem(),k(e);break;case t.TURN_SNAKE_LEFT:i.setDirection(s.LEFT);break;case t.TURN_SNAKE_UP:i.setDirection(s.UP);break;case t.TURN_SNAKE_RIGHT:i.setDirection(s.RIGHT);break;case t.TURN_SNAKE_DOWN:i.setDirection(s.DOWN);break;case t.NEW_GAME:E(e),e.start();break;case t.CONTINUE_GAME:e.start();break;default:}}function x(e){T(e),e.scoreBoard.incrementScore()}function T(t){t.apple=new e(t.cellSize,-1,-1),t.apple.placeRandomly(t)}function N(e){var t=e.snake;t.move(e)}function C(e){N(e)}function k(e){var t=e.graphics,n=e.snake,r=n.getDrunkness(),i=e.frameNumber;i%(r+1)===0&&t.reset(),e.isStopped()||e.apple.draw(t),e.snake.draw(t)}function L(e){e.isStopped()?e.start():e.pause()}var l=u.graphics.Graphics,c=u.input.Manipulator,h=u.ui.Menu,p=u.utils.timeUtils,d=u.utils.htmlUtils,v=p.cancelAnimationFrame,m=p.requestAnimationFrame,g=p.timeNow,y=d.getBody;return b.prototype.start=function(){this.stopped=!1,this.manipulator.setControls(n),this.menu!==this.pausedGameMenu&&(this.menu.hide(),this.menu=this.pausedGameMenu),this.menu.focusFirstItem(),this.menu.hide(),this.then=g(),this.run()},b.prototype.pause=function(){var e=this.lastRequestId;e&&(this.manipulator.setControls(i),v(e)),this.lastRequestId=0,this.menu.reveal(),this.stopped=!0},b.prototype.isStopped=function(){return this.stopped},b.prototype.run=function(){var e=this.run.bind(this),t=this,n=function(){t.then=g(),t.lastRequestId=m(e),t.frameNumber++,C(t),k(t)},r=0,i=1e3/this.fps,s=this.isStopped();s||(r=g()-this.then,i-=r,setTimeout(n,i))},b.prototype.getCellsWidth=function(){return this.cellsWidth},b.prototype.getCellsHeight=function(){return this.cellsHeight},b}),define("game",["game/Game"],function(e){return e}),define("propertyParser",[],function(){function n(t){var n,i={};while(n=e.exec(t))i[n[1]]=r(n[2]||n[3]);return i}function r(e){return t.test(e)?e=e.replace(t,"$1").split(","):e==="null"?e=null:e==="false"?e=!1:e==="true"?e=!0:e===""||e==="''"||e==='""'?e="":isNaN(e)||(e=+e),e}var e=/([\w-]+)\s*:\s*(?:(\[[^\]]+\])|([^,]+)),?/g,t=/^\[([^\]]+)\]$/;return{parseProperties:n,typecastVal:r}}),define("font",["propertyParser"],function(e){function n(n){var r={},i=n.split("|"),s=i.length,o;while(s--)o=t.exec(i[s]),r[o[1]]=e.parseProperties(o[2]);return r}var t=/^([^,]+),([^\|]+)\|?/;return{load:function(e,t,r,i){if(i.isBuild)r(null);else{var s=n(e);s.active=r,s.inactive=function(){r(!1)},t([(document.location.protocol==="https:"?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js"],function(){WebFont.load(s)})}}}}),define("app/main",["domReady","game","font!custom,families:[Wendy],urls:[style/style.css]"],function(e,t){function n(){var e=20,n=48,r=30,i=new t(e,n,r)}e(n)}),requirejs.config({baseUrl:"js/lib",paths:{app:"../app"},packages:[{name:"game",location:"../app/game",main:"Game"},{name:"engine",location:"../app/engine",main:"main"}]}),requirejs(["app/main"]),define("app",function(){});